# Preliminaries

Install Xilinx Vivado 2016.4 and Xilinx SDK 2016.4 with Ultrascale+ SoC device
support selected.  
  

Add Xilinx tools (including aarch64 toolchain) to path.

```
source /opt/Xilinx/Vivado/2016.4/settings.sh
source /opt/Xilinx/SDK/2016.4/settings.sh
```

# Firmware image (boot.bin) components

## bl31.elf

```
git clone https://github.com/Xilinx/arm-trusted-firmware.git
cd arm-trusted-firmware
make CROSS_COMPILE=aarch64-linux-gnu- PLAT=zynqmp RESET_TO_BL31=1
file ./build/zynqmp/release/bl31/bl31.elf
```

## fsbl.elf

First stage boot loader. Xilinx SDK 2016.4 generated.
Uses hardware definition generated in oh/src/zcu102/fpga/zcu102

## pmu.elf

Power management unit firmware.
Generated by Xilinx SDK 2016.4.

## boot_a53_pl.bif

Used to convert FPGA bitstream to format that can be used by u-boot / Linux
fpgamanager.

## boot_a53_ps.bif

boot.bin image layout file.

## system.bit

FPGA bitstream with elink

```
git clone https://github.com/olajep/oh -b zcu102
cd oh/src/zcu102/fpga
make
file zcu102/system.bit
```

## u-boot.elf

u-boot boot loader

```
git clone https://github.com/Xilinx/u-boot-xlnx.git
cd u-boot-xlnx
make CROSS_COMPILE=aarch64-linux-gnu- xilinx_zynqmp_zcu102_revB_defconfig
make CROSS_COMPILE=aarch64-linux-gnu-
```

## Image

Kernel image

```
git clone https://github.com/Xilinx/linux-xlnx.git
cd linux-xlnx
make CROSS_COMPILE=aarch64-linux-gnu- ARCH=arm64 xilinx_zynqmp_zcu102_defconfig
make CROSS_COMPILE=aarch64-linux-gnu- ARCH=arm64
file ./arch/arm64/boot/Image ./arch/arm64/boot/dts/xilinx/zynqmp-zcu102-revB.dtb
```

## system.dtb

Device tree.
Generated when building kernel above.
zynqmp-zcu102-revB.dtb renamed to system.dtb.

## uEnv.txt

Custom environment variables and commands for u-boot.
Loads 'system.bit.bin'

## Makefile

# Generated files
| Name | Description
|------|------------
|boot.bin | boot image
|system.bit.bin | u-boot compatible fpga bitstream
  
Building:  
```
make
```

# Installing firmware (including linux image):

Copy these files to the SD card BOOT partition.

```
boot.bin
uEnv.txt
system.bit.bin
Image
system.dtb
```

# zcu102 instructions

Instructions for getting started with zcu102.

1. Buy this board
https://www.xilinx.com/products/boards-and-kits/ek-u1-zcu102-es2-g.html
Part Number: EK-U1-ZCU102-ES2-G

2. Follow quick start instructions that comes with board.

3. Configure board to boot from SD card. Note that the manual is wrong. SW6 should be configured in '0xE' mode for Rev 1.0 boards.
See sw6-config.jpg
![SW6 config](https://github.com/adapteva/metaserver-firmware/raw/master/sw6-config.jpg "SW6 config")

4. Download Ubuntu SD card image from here:  
http://www.wiki.xilinx.com/Zynq+UltraScalePlus+MPSoC+-+Ubuntu+Desktop+Step+by+Step+Guide  

5. Write image to SD card

6. Copy firmware files (installing firmware section) to the SD card BOOT partition.
